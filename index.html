<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba WebSocket - Arrays Booleanos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .connected {
            background-color: #d4edda;
            color: #155724;
        }
        .disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }
        .array-display {
            margin: 20px 0;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .toggle-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .toggle-buttons button {
            flex: 1;
            padding: 15px;
        }
        #log {
            margin-top: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Prueba WebSocket - Arrays Booleanos</h1>
        <div id="status" class="status disconnected">Desconectado</div>
        
        <div class="array-display">
            <h3>Tu Array:</h3>
            <div id="myArray" class="toggle-buttons"></div>
        </div>

        <div class="array-display">
            <h3>Array Combinado:</h3>
            <div id="combinedArray" class="toggle-buttons"></div>
        </div>

        <button onclick="toggleConnection()">Conectar/Desconectar</button>
        
        <div id="log"></div>
    </div>

    <script>
        let ws = null;
        let myArray = [false, false, false, false, false];
        let otherArrays = [];
        const arraySize = 5;

        // Funci贸n para agregar logs
        function addLog(message) {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // Crear botones para el array
        function createArrayButtons() {
            const myArrayDiv = document.getElementById('myArray');
            const combinedArrayDiv = document.getElementById('combinedArray');
            
            myArrayDiv.innerHTML = '';
            combinedArrayDiv.innerHTML = '';

            for (let i = 0; i < arraySize; i++) {
                // Botones para mi array
                const button = document.createElement('button');
                button.textContent = 'Falso';
                button.style.backgroundColor = '#dc3545';
                button.onclick = () => toggleValue(i);
                myArrayDiv.appendChild(button);

                // Botones para el array combinado
                const combinedButton = document.createElement('button');
                combinedButton.textContent = 'Falso';
                combinedButton.style.backgroundColor = '#dc3545';
                combinedButton.disabled = true;
                combinedArrayDiv.appendChild(combinedButton);
            }
        }

        // Actualizar la visualizaci贸n del array
        function updateArrayDisplay() {
            const buttons = document.getElementById('myArray').children;
            for (let i = 0; i < arraySize; i++) {
                buttons[i].textContent = myArray[i] ? 'Verdadero' : 'Falso';
                buttons[i].style.backgroundColor = myArray[i] ? '#28a745' : '#dc3545';
            }
        }

        // Funci贸n para combinar arrays
        function combinarArrays(arrays) {
            if (arrays.length === 0) return myArray;
            
            return arrays.reduce((resultado, array) => {
                return resultado.map((valor, index) => valor || array[index]);
            }, myArray);
        }

        // Actualizar el array combinado
        function updateCombinedArray() {
            const combinedArray = combinarArrays(otherArrays);
            const buttons = document.getElementById('combinedArray').children;
            
            for (let i = 0; i < arraySize; i++) {
                buttons[i].textContent = combinedArray[i] ? 'Verdadero' : 'Falso';
                buttons[i].style.backgroundColor = combinedArray[i] ? '#28a745' : '#dc3545';
            }
            addLog(`Array combinado actualizado: ${JSON.stringify(combinedArray)}`);
        }

        // Cambiar el valor de un elemento del array
        function toggleValue(index) {
            myArray[index] = !myArray[index];
            updateArrayDisplay();
            if (ws && ws.readyState === WebSocket.OPEN) {
                const message = JSON.stringify({
                    type: 'array',
                    array: myArray,
                    timestamp: Date.now() // Agregar timestamp para evitar duplicados
                });
                ws.send(message);
                addLog(`Enviando array: ${message}`);
            }
            updateCombinedArray();
        }

        // Conectar/Desconectar WebSocket
        function toggleConnection() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.close();
            } else {
                // Usar el servidor de prueba echo.websocket.org
                ws = new WebSocket('wss://echo.websocket.org');
                
                ws.onopen = () => {
                    document.getElementById('status').className = 'status connected';
                    document.getElementById('status').textContent = 'Conectado';
                    addLog('Conectado al servidor WebSocket');
                    
                    const message = JSON.stringify({
                        type: 'array',
                        array: myArray,
                        timestamp: Date.now()
                    });
                    ws.send(message);
                    addLog(`Enviando array inicial: ${message}`);
                };

                ws.onclose = () => {
                    document.getElementById('status').className = 'status disconnected';
                    document.getElementById('status').textContent = 'Desconectado';
                    otherArrays = [];
                    updateCombinedArray();
                    addLog('Desconectado del servidor WebSocket');
                };

                ws.onerror = (error) => {
                    addLog(`Error en WebSocket: ${error.message}`);
                };

                ws.onmessage = (event) => {
                    try {
                        addLog(`Mensaje recibido: ${event.data}`);
                        const data = JSON.parse(event.data);
                        if (data.type === 'array') {
                            // Verificar si el array ya existe en otherArrays
                            const existingIndex = otherArrays.findIndex(arr => 
                                arr.timestamp === data.timestamp
                            );

                            if (existingIndex === -1) {
                                otherArrays.push(data);
                                addLog(`Nuevo array agregado: ${JSON.stringify(data.array)}`);
                            } else {
                                otherArrays[existingIndex] = data;
                                addLog(`Array actualizado: ${JSON.stringify(data.array)}`);
                            }

                            updateCombinedArray();
                        }
                    } catch (error) {
                        addLog(`Error al procesar mensaje: ${error.message}`);
                    }
                };
            }
        }

        // Inicializar la interfaz
        createArrayButtons();
        updateArrayDisplay();
        updateCombinedArray();
        addLog('Aplicaci贸n iniciada');
    </script>
</body>
</html> 